@model Proyecto_Pymes.Models.DB.Producer
@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<div class="container-fluid">



    <h1 style="text-align:center; color: white" >Editar Productor</h1>

    <form method="post" action="/Producer/Edit" style="color: white" >

       <input hidden asp-for="Id"/>
       <input hidden asp-for="Status"/>
        <input hidden asp-for="RegisterDate"/>
        <input hidden asp-for="UserId"/>

        <input hidden asp-for="IdNavigation.Id"/>
        <input hidden asp-for="IdNavigation.Status"/>
        <input hidden asp-for="IdNavigation.RegisterDate"/>


        <div asp-validation-summary="ModelOnly" class="text-danger"></div>

        <div class="col-md-12">
            <div class="row">
                <div class="col-md-12">
                    <div class="form-group">
                        <label for="">Nombre:</label>
                        <input type="text" class="form-control" asp-for="IdNavigation.Name" id="" aria-describedby="helpId" placeholder="Nombre">
                        <span asp-validation-for="IdNavigation.Name" class="text-danger" style="font-size: 12px;"></span>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-12">
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="">Primer Apellido:</label>
                        <input type="text" class="form-control" asp-for="IdNavigation.LastName" id="" aria-describedby="helpId" placeholder="Primer Apellido">
                        <span asp-validation-for="IdNavigation.LastName" class="text-danger" style="font-size: 12px;"></span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="">Segundo Apellido (Opcional):</label>
                        <input type="text" class="form-control" asp-for="IdNavigation.SecondLastName" id="" aria-describedby="helpId" placeholder="Segundo Apellido">
                        <span asp-validation-for="IdNavigation.SecondLastName" class="text-danger" style="font-size: 12px;"></span>
                    </div>
                </div>
            </div>
        </div>



        <div class="col-md-12">
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="">Celular:</label>
                        <input type="text" class="form-control" asp-for="IdNavigation.PhoneNumber" id="" aria-describedby="helpId" placeholder="Celular">
                        <span asp-validation-for="IdNavigation.PhoneNumber" class="text-danger" style="font-size: 12px;"></span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="">Correo Electronico:</label>
                        <input type="email" class="form-control" asp-for="IdNavigation.Email" id="" aria-describedby="helpId" placeholder="Correo Electronico">
                        <span asp-validation-for="IdNavigation.Email" class="text-danger" style="font-size: 12px;"></span>
                    </div>
                </div>
            </div>
        </div>



        <div class="col-md-12">
            <div class="row">
                <div class="col-md-6">
                    <div class="row">

                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="">CI:</label>
                                <input type="text" class="form-control" asp-for="IdNavigation.Ci" id="" aria-describedby="helpId" placeholder="CI">
                                <span asp-validation-for="IdNavigation.Ci" class="text-danger" style="font-size: 12px;"></span>
                            </div>
                        </div>

                        <div class="col-md-12">
                            <label for="">Genero:</label>
                            <br>
                            <div class="form-check form-check-inline">
                                <input asp-for="IdNavigation.Gender" class="form-check-input" type="radio"  id="inlineRadio1" value="M">
                                <label class="form-check-label" for="inlineRadio1">Masculino</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input asp-for="IdNavigation.Gender" class="form-check-input" type="radio"  id="inlineRadio2" value="F">
                                <label class="form-check-label" for="inlineRadio2">Femenino</label>
                            </div>
                            <span asp-validation-for="IdNavigation.Gender" class="text-danger" style="font-size: 12px;"></span>

                        </div>
                    </div>

                </div>


                <div class="col-md-6">
                    <div class="row">
                        <div class="col-md-12 my-3">
                            <label for="">Ubicacion : </label>
                            <button type="button" class="btn btn-info" data-toggle="modal" data-target="#mapModal">
                                <i class="fas fa-map"></i> Seleccione su Ubicacion
                            </button>
                        </div>
                        <div class="col-md-12">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="">Latitud</label>
                                        <input type="text" id="latitudeInput" readonly class="form-control" asp-for="Latitude" aria-describedby="helpId" placeholder="Latitud">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="">Longitud</label>
                                        <input type="text" id="longitudeInput" readonly class="form-control" asp-for="Longitude" aria-describedby="helpId" placeholder="Longitud">
                                    </div>
                                </div>
                                <span asp-validation-for="Longitude" class="text-danger" style="font-size: 12px;"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <br>

            <div class="col-md-12 my-3 text-center">
                <div class="row">
                    <div class="col-md-3">
                    </div>
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="text-center">
                                    <button type="submit" class="btn  btn-md  btn-block" style="background-color:#15718d; color:white;">Actualizar</button> <!-- Agregamos "btn-block" para que ocupe todo el ancho -->
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="text-center">
                                    <a asp-action="Index" class="btn  btn-md btn-block" style="background-color:#bb2727; color:white;">Cancelar</a> <!-- Agregamos "btn-block" para que ocupe todo el ancho -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                    </div>
                </div>
            </div>
        </div>
    </form>




    <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true" data-backdrop="static">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Mensaje</h5>
                </div>
                <div class="modal-body">
                    <p>Productor Actualizado @Model.IdNavigation.Name correctamente! <i class="fas fa-check-circle"></i></p>
                </div>
                <div class="modal-footer">
                    <a asp-controller="Producer" asp-action="Index" class="btn btn-warning">Aceptar</a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal para el mapa -->
<div class="modal fade" id="mapModal" tabindex="-1" role="dialog" aria-labelledby="mapModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="mapModalLabel">Selecciona una Ubicación en el Mapa</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Cerrar">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Mapa va aquí -->
                <div id="myMapModal" style="width: 100%; height: 400px;"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn-primary" id="guardarUbicacion">Guardar Ubicación</button>
            </div>
        </div>
    </div>
</div>



@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    @if (TempData["ShowModal"] as bool? == true)
    {
        <script>
            $(document).ready(function () {
                $('#exampleModalCenter').modal('show');
            });
        </script>
    }
}





<script type="text/javascript">
    var map;
    function loadMapWithCoordinates(latitude, longitude) {

        map = new Microsoft.Maps.Map(document.getElementById('myMapModal'), {
            credentials: 'ArJV2O-S7qPYbCg0KZEXvvwJjyechBcXzEHDp2lhXBT37ie8ax8PaLOu9N8gal2d',
            center: new Microsoft.Maps.Location(latitude, longitude), // Centro del mapa
            zoom: 12 // Nivel de zoom
        });


        // Crea un nuevo cursor de localización y colócalo en la posición proporcionada------------------
        var location = new Microsoft.Maps.Location(latitude, longitude);
        var centerMarker = new Microsoft.Maps.Pushpin(location, {
            icon: 'https://www.bingmapsportal.com/Content/images/poi_custom.png', // Puedes cambiar la imagen del cursor
            draggable: true
        });
        // Añade el cursor de localización al mapa
        map.entities.clear(); 
        map.entities.push(centerMarker);
        console.log("Se creó el cursor");
        document.getElementById('latitudeInput').value = latitude;
        document.getElementById('longitudeInput').value = longitude;
        //---------------------------------------------------------------------------------------------


        // Agrega un manejador de eventos para el evento de arrastre del cursor
        Microsoft.Maps.Events.addHandler(map, 'click', function (e) {
         
            var location = e.location;
            var latitude = location.latitude;
            var longitude = location.longitude;
            // Crea un nuevo cursor de localización y colócalo en la posición del clic
            var centerMarker = new Microsoft.Maps.Pushpin(location, {
                icon: 'https://www.bingmapsportal.com/Content/images/poi_custom.png', // Puedes cambiar la imagen del cursor
                draggable: true
            });
            // Añade el cursor de localización al mapa
            map.entities.clear(); // Borra todos los marcadores existentes en el mapa
            map.entities.push(centerMarker);
            // Actualiza los valores de los campos de entrada
            document.getElementById('latitudeInput').value = latitude;
            document.getElementById('longitudeInput').value = longitude;
        });
     
    }

    $(document).ready(function () {
        $('#mapModal').on('shown.bs.modal', function () {
            // Obtiene las coordenadas de los campos de entrada
            var latitude = parseFloat(document.getElementById('latitudeInput').value);
            var longitude = parseFloat(document.getElementById('longitudeInput').value);
            // Carga el mapa con las coordenadas proporcionadas
            loadMapWithCoordinates(latitude, longitude);
        });
        $('#guardarUbicacion').on('click', function () {
            // Tu código para manejar el clic en "Guardar Ubicación" en el modal
            $('#mapModal').modal('hide');
        });
    });
</script>
<script type="text/javascript" src="https://www.bing.com/api/maps/mapcontrol?callback=loadMapScenario"></script>